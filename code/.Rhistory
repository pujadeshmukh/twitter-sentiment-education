p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
p
p.usa <- p + coord_cartesian(ylim=c(22, 52), xlim=c(-130,-60))
p.usa
View(estream)
estream <- stream[stream$score!=0,c("lat","lng","score")]
N <- 500
estream$clng <- as.numeric(cut(estream$lng, breaks=N*2))
estream$clat <- as.numeric(cut(estream$lat, breaks=N))
dt <- data.table(estream)
setkey(dt, clat, clng)
m <- dt[,list(lat=mean(lat),lng=mean(lng),score=mode(score),size=10*log(length(score)+1,2)),by="clat,clng"]
m <- data.frame(m)[,3:6]
m <- rbind(m, data.frame(lng=0,lat=0,score=0,size=1))
world <- fortify(getMap(resolution="low"))
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=0.9, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
# usa
p.usa <- p + coord_cartesian(ylim=c(22, 52), xlim=c(-130,-60))
p.usa
summary(m$size)
(m$size/max(m$size))
max((1-(m$size/max(m$size))), 0.2)
max((1-(m$size/max(m$size))), 0.2)
(1-(m$size/max(m$size)))
(1-(m$size/max(m$size)))
m$alpha <- (1-(m$size/max(m$size)))
summary(m$alpha)
m$alpha <- ifelse(m$alpha<0.2, 0.2, m$alpha)
summary(m$alpha)
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=alpha, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
m$alpha
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=alpha, position="jitter")
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=m$alpha, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=0.8, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
p.usa <- p + coord_cartesian(ylim=c(22, 52), xlim=c(-130,-60))
p.usa
install.packages(c("Formula", "HSAUR", "HSAUR2", "rgl", "Rmpi"))
library(RTextTools);
install.packages("RTextTools")
require(devtools)
install_github("RTextTools", "timjurka")
install("https://github.com/timjurka/RTextTools/blob/master/RTextTools_1.4.0.tar.gz")
install("/home/ales/RTextTools_1.4.0.tar.gz")
install("/home/ales/RTextTools")
install.packages("maxent")
rm(list=c("estream","m","world","N","dt","p","p.usa","p.europe"))
source('~/docs/Dropbox/Docs/study/Publications/2013/2013-03-IOT/code/utils.R')
source('~/docs/Dropbox/Docs/study/Publications/2013/2013-03-IOT/code/sentiment.R')
source('~/docs/Dropbox/Docs/study/Publications/2013/2013-03-IOT/code/geonames.R')
Pandoc.convert("../writing/article.md", format="docx")
require(pander)
Pandoc.convert("../writing/article.md", format="docx")
##
## Clearing the workspace
##
rm(list=ls(all=TRUE))
gc(reset=TRUE)
set.seed(12345)
##
## Required packages
##
require(ggplot2)
require(rworldmap)
require(data.table)
source("sentiment.R")
##
## Reading stream
##
# stream <- read.table(file="../data/tweets.txt", header=F, sep="\t",
#                      encoding="UTF-8",
#                      fill=T, allowEscapes=T,
#                      col.names=c("id","date","text","lang","lat","lng","country","code"))
# stream <- na.omit(stream)
# stream$score <- NA
##
## Scoring sentiments (by K tweets at once in order to control memory consumption)
##
# K <- min(2000, nrow(stream))
# N <- (nrow(stream) %/% K) + 1
# for(i in 1:N){
#   start  <- (i-1)*K + 1
#   finish <- i*K
#   if(i==N) finish <- nrow(stream)
#
#   stream$score[start:finish] <- score.sentiment(stream$text[start:finish])
# }
# rm(list=c("K","N","i","start","finish"))
# save(stream, file="../data/stream.rda")
load("../data/stream.rda")
##
## Getting typical tweets
##
stream$score[stream$score> +2] <- +2
stream$score[stream$score< -2] <- -2
##
## Plotting to the map
##
estream <- stream[stream$score!=0,c("lat","lng","score")]
N <- 500
estream$clng <- as.numeric(cut(estream$lng, breaks=N*2))
estream$clat <- as.numeric(cut(estream$lat, breaks=N))
dt <- data.table(estream)
setkey(dt, clat, clng)
m <- dt[,list(lat=mean(lat),lng=mean(lng),score=mode(score),size=log(length(score)+1,2)),by="clat,clng"]
m <- data.frame(m)[,3:6]
m <- rbind(m, data.frame(lng=0,lat=0,score=0,size=1))
world <- fortify(getMap(resolution="low"))
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=0.8, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
# usa
p.usa <- p + coord_cartesian(ylim=c(22, 52), xlim=c(-130,-60))
p.usa
View(estream)
source("utils.R")
##
estream <- stream[stream$score!=0,c("lat","lng","score")]
N <- 500
estream$clng <- as.numeric(cut(estream$lng, breaks=N*2))
estream$clat <- as.numeric(cut(estream$lat, breaks=N))
dt <- data.table(estream)
setkey(dt, clat, clng)
m <- dt[,list(lat=mean(lat),lng=mean(lng),score=mode(score),size=log(length(score)+1,2)),by="clat,clng"]
m <- data.frame(m)[,3:6]
m <- rbind(m, data.frame(lng=0,lat=0,score=0,size=1))
world <- fortify(getMap(resolution="low"))
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=0.8, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
# usa
p.usa <- p + coord_cartesian(ylim=c(22, 52), xlim=c(-130,-60))
p.usa
ggsave(file="../writing/figure/map.usa.pdf",p.usa,cairo_pdf,dpi=600,width=25,height=15,units="cm")
ggsave(file="../writing/figure/map.usa.png",p.usa,dpi=600,width=25,height=15,units="cm")
ggsave(file="../writing/figure/map.usa.pdf",p.usa,cairo_pdf,dpi=600,width=25,height=15,units="cm")
rm(list=c("estream","m","world","N","dt","p","p.usa","p.europe"))
require(pander)
require(knitcitations)
require(bibtex)
cite_options(numerical=TRUE)
Pandoc.convert("../writing/article.md", format="docx")
source('~/docs/Dropbox/Docs/study/Publications/2013/2013-03-IOT/code/sentiment.R')
load("../data/stream.rda")
plot.wordcloud(stream$text[stream$score>0], "../writing/figure/word.cloud.pos.pdf")
plot.wordcloud(stream$text[stream$score<0], "../writing/figure/word.cloud.neg.pdf")
source('~/docs/Dropbox/Docs/study/Publications/2013/2013-03-IOT/code/sentiment.R')
plot.wordcloud(stream$text[stream$score>0], "../writing/figure/word.cloud.pos.pdf")
plot.wordcloud(stream$text[stream$score<0], "../writing/figure/word.cloud.neg.pdf")
source('~/docs/Dropbox/Docs/study/Publications/2013/2013-03-IOT/code/sentiment.R')
plot.wordcloud(stream$text[stream$score>0], "../writing/figure/word.cloud.pos.pdf")
plot.wordcloud(stream$text[stream$score<0], "../writing/figure/word.cloud.neg.pdf")
stream$score[stream$score> +2] <- +2
stream$score[stream$score< -2] <- -2
topnames <- c("BY","KZ","LT","UA","PL","RU","US","UK")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top)
h
h
topnames
stream$top
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top)
stream$top <- "World"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h
ggsave("../writing/figure/density.pdf", plot=h, dpi=300, width=25, height=10, units="cm")
topnames <- names(sort(table(stream$code), decreasing=T)[1:3])
topnames <- c("BY","LT","UA","PL","RU","US","UK")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
rm(list=ls(all=TRUE))
gc(reset=TRUE)
set.seed(12345)
##
## Required packages
##
require(ggplot2)
require(rworldmap)
require(data.table)
source("sentiment.R")
source("utils.R")
load("../data/stream.rda")
stream$score[stream$score> +2] <- +2
stream$score[stream$score< -2] <- -2
topnames <- c("BY","LT","UA","PL","RU","US","UK")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top)
stream$top <- "World"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top)
stream$top <- "World"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top+cat)
stream$top <- "World"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top+cat)
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
View(stream)
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~cat)
h
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top~cat)
h
topnames <- c("BY","LT","UA","PL")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_grid(.~top)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h + facet_wrap(.~top)
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_wrap(.~top, nrow=2)
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h + facet_wrap(.~cat, nrow=2)
h + facet_wrap(~cat, nrow=2)
h + facet_wrap(~top, nrow=2)
h + facet_wrap(~top+cat, nrow=2)
h + facet_wrap(cat~top, nrow=2)
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + facet_wrap(cat~top, nrow=2)
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h + facet_wrap(cat~top, nrow=2)
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_grid(cat~top)
h
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_wrap(cat~top, nrow=2)
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_wrap(cat~top, nrow=2)
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_wrap(cat~top, nrow=2)
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_grid(cat~top)
h
topnames <- c("BY","LT","UA","PL","RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "World"
stream$cat <- "High"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_grid(cat~top,drop=T)
h
h + facet_wrap(cat~top,nrow=2)
h + facet_grid(cat~top,nrow=2)
h + facet_grid(cat~top)
h + facet_grid(cat~top, scales="free")
h + facet_grid(cat~top,space="free")
h + facet_grid(cat~top, drop=TRUE)
h + facet_grid(cat~top, as.table=FALSE)
?facet_grid
h + facet_grid(cat+top~.)
h + facet_grid(.~cat+top)
h + facet_grid(cat~cat+top)
h + facet_grid(cat~top)
h + facet_grid(cat~top) + opts(strip.text.y = theme_blank())
h + facet_grid(cat~top) + theme(strip.text.y = theme_blank())
h + facet_grid(cat~top)
h + facet_grid(cat~top, margin=T)
h + facet_wrap(cat~top, nrow=2)
h + facet_wrap(cat~top, nrow=2, labeller=df)
h + facet_grid(cat~top, scales = "free_y", space = "free_y")
h + facet_grid(cat~top, scales = "free_y", space = "free_y", drop=T)
topnames <- c("BY","LT","UA","PL")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$cat <- ifelse(stream$top %in% c("BY","LT","UA","PL"), "Low", "High")
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h
h + facet_grid(cat~top, scales = "free_y", space = "free_y", drop=T)
h + facet_grid(.~top, scales = "free_y", space = "free_y", drop=T)
h <- h + facet_grid(.~top, scales = "free_y", space = "free_y", drop=T)
h
ggsave("../writing/figure/density.low.pdf", plot=h, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.low.pdf", plot=h, pdf.cairo, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.low.pdf", plot=h, cairo_pdf, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.low.png", plot=h, cairo_pdf, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.low.png", plot=h, dpi=300, width=25, height=10, units="cm")
stream$top[stream$top=="BY"] <- "Беларусь"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_grid(.~top, scales = "free_y", space = "free_y", drop=T)
h
stream$top[stream$top=="BY"] <- "Беларусь"
stream$top[stream$top=="LT"] <- "Литва"
stream$top[stream$top=="UA"] <- "Украина"
stream$top[stream$top=="PL"] <- "Польша"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_grid(.~top, scales = "free_y", space = "free_y", drop=T)
h
ggsave("../writing/figure/density.low.pdf", plot=h,  cairo_pdf, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.low.png", plot=h,dpi=300, width=25, height=10, units="cm")
topnames <- c("RU","US","GB")
stream$top <- as.character(stream$code)
stream$top[!(stream$code %in% topnames)] <- "Other"
stream$top[stream$top=="RU"] <- "Россия"
stream$top[stream$top=="US"] <- "США"
stream$top[stream$top=="GB"] <- "Великобритания"
h <- ggplot() + theme_bw()
h <- h + geom_histogram(data=stream[stream$top!="Other",], aes(x=score, y=..density..), binwidth=0.5)
stream$top <- "Всего"
h <- h + geom_histogram(data=stream, aes(x=score, y=..density..), binwidth=0.5)
h <- h + scale_x_continuous(labels=c(-2:2), breaks=c(-2:2)+0.25)
h <- h + xlab("Оценки") + ylab("Плотность")
h <- h + facet_grid(.~top, scales = "free_y", space = "free_y", drop=T)
h
ggsave("../writing/figure/density.high.png", plot=h, cairo_pdf, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.high.pdf", plot=h, cairo_pdf, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.high.png", plot=h, dpi=300, width=25, height=10, units="cm")
ggsave("../writing/figure/density.high.png", plot=h, dpi=600, width=25, height=10, units="cm")
ggsave("../writing/figure/density.high.png", plot=h, dpi=300, width=25, height=10, units="cm")
estream <- stream[stream$score!=0,c("lat","lng","score")]
N <- 500
estream$clng <- as.numeric(cut(estream$lng, breaks=N*2))
estream$clat <- as.numeric(cut(estream$lat, breaks=N))
dt <- data.table(estream)
setkey(dt, clat, clng)
m <- dt[,list(lat=mean(lat),lng=mean(lng),score=mode(score),size=log(length(score)+1)),by="clat,clng"]
m <- data.frame(m)[,3:6]
m <- rbind(m, data.frame(lng=0,lat=0,score=0,size=1))
world <- fortify(getMap(resolution="low"))
p <- ggplot() + theme_bw()
p <- p + geom_polygon(data=world, aes(x=long, y=lat, group=group),
colour="#888888", fill="#eeeeff", alpha=0.3)
p <- p + geom_point(data=m, aes(x=lng,y=lat,colour=as.factor(score),size=size), alpha=0.8, position="jitter")
p <- p + scale_colour_manual(name="Оценка", values=c("red","red","#999999","#00dd00","#00dd00"))
p <- p + scale_size(guide="none")
p <- p + xlab("Долгота, градусы") + ylab("Широта, градусы")
# world
p
# usa
p.usa <- p + coord_cartesian(ylim=c(22, 52), xlim=c(-130,-60))
p.usa
# europe
p.europe <- p + coord_cartesian(ylim=c(30, 70), xlim=c(-10,50))
ggsave(file="../writing/figure/map.pdf",p,cairo_pdf,dpi=600,width=25,height=15,units="cm")
ggsave(file="../writing/figure/map.europe.pdf",p.europe,cairo_pdf,dpi=600,width=25,height=15,units="cm")
ggsave(file="../writing/figure/map.usa.pdf",p.usa,cairo_pdf,dpi=600,width=25,height=15,units="cm")
